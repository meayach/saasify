<!DOCTYPE html>
<html>
  <head>
    <title>Test Plan Selection - Step by Step</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      button {
        padding: 10px;
        margin: 5px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #0056b3;
      }
      .step {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .info {
        background: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Test du Workflow de S√©lection de Plan</h1>

    <div class="step">
      <h2>√âtape 1: Pr√©parer le plan test</h2>
      <p>
        Ajouter un plan au localStorage pour simuler la s√©lection depuis la page
        des plans
      </p>
      <button onclick="preparePlan()">üìã Pr√©parer Plan Test</button>
      <div id="step1Status"></div>
    </div>

    <div class="step">
      <h2>√âtape 2: Naviguer vers la page de configuration</h2>
      <p>
        Aller √† la page de configuration d'application o√π le plan devrait
        s'afficher
      </p>
      <button onclick="goToConfiguration()" id="configBtn" disabled>
        üîß Page Configuration
      </button>
      <div id="step2Status"></div>
    </div>

    <div class="step">
      <h2>√âtape 3: D√©bugger le localStorage</h2>
      <button onclick="showLocalStorage()">üëÄ Voir localStorage</button>
      <button onclick="clearAll()">üßπ Nettoyer tout</button>
      <div id="debugInfo"></div>
    </div>

    <script>
      let applicationId = "68a87801a0fc8740c837946c"; // ID de l'application Slack

      function preparePlan() {
        const plan = {
          id: "68bf677bdf8ea2b424543a03",
          name: "Plan Enterprise",
          description: "Plan complet pour les grandes organisations",
          type: "ENTERPRISE",
          billingCycle: "MONTHLY",
          price: 99.99,
          currency: "EUR",
          isActive: true,
          isPopular: false,
          includedFeatures: [
            "Fonctionnalit√© A",
            "Fonctionnalit√© B",
            "Support 24/7",
          ],
          createdAt: "2025-09-08T23:32:11.549Z",
          updatedAt: "2025-09-08T23:32:11.549Z",
        };

        // Stocker dans localStorage
        localStorage.setItem("selectedPlan", JSON.stringify(plan));
        localStorage.setItem("selectedApplicationId", applicationId);

        // Mettre √† jour l'interface
        document.getElementById("step1Status").innerHTML =
          '<div class="status success">‚úÖ Plan pr√©par√© avec succ√®s !</div>';
        document.getElementById("configBtn").disabled = false;

        showLocalStorage();
      }

      function goToConfiguration() {
        // Ouvrir dans un nouvel onglet pour garder cette page
        window.open(
          `http://localhost:4201/applications/configure/${applicationId}`,
          "_blank"
        );

        document.getElementById("step2Status").innerHTML =
          '<div class="status info">üìñ Page de configuration ouverte dans un nouvel onglet</div>';
      }

      function showLocalStorage() {
        const selectedPlan = localStorage.getItem("selectedPlan");
        const selectedApplicationId = localStorage.getItem(
          "selectedApplicationId"
        );

        let html = "<h3>üìä √âtat du localStorage:</h3>";

        if (selectedPlan) {
          const plan = JSON.parse(selectedPlan);
          html += `
                    <div class="status success">
                        <strong>‚úÖ selectedPlan trouv√©:</strong><br>
                        Nom: ${plan.name}<br>
                        Prix: ${plan.price} ${plan.currency}<br>
                        ID: ${plan.id}
                    </div>
                `;
        } else {
          html +=
            '<div class="status info">‚ùå Aucun selectedPlan dans localStorage</div>';
        }

        if (selectedApplicationId) {
          html += `<div class="status success"><strong>‚úÖ selectedApplicationId:</strong> ${selectedApplicationId}</div>`;
        } else {
          html +=
            '<div class="status info">‚ùå Aucun selectedApplicationId dans localStorage</div>';
        }

        document.getElementById("debugInfo").innerHTML = html;
      }

      function clearAll() {
        localStorage.removeItem("selectedPlan");
        localStorage.removeItem("selectedApplicationId");

        document.getElementById("step1Status").innerHTML = "";
        document.getElementById("step2Status").innerHTML = "";
        document.getElementById("configBtn").disabled = true;

        showLocalStorage();
      }

      // V√©rifier l'√©tat au chargement
      window.onload = function () {
        showLocalStorage();

        // Activer le bouton si un plan est d√©j√† pr√©sent
        if (localStorage.getItem("selectedPlan")) {
          document.getElementById("configBtn").disabled = false;
          document.getElementById("step1Status").innerHTML =
            '<div class="status info">üí° Plan d√©j√† pr√©sent dans localStorage</div>';
        }
      };
    </script>
  </body>
</html>
