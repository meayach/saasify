<div class="container">
  <div class="card">
    <div class="card-header">
      <h2>Créer un nouveau plan</h2>
    </div>
    <div class="card-body">
      <form [formGroup]="planForm" (ngSubmit)="onSubmit()">
        <div class="row">
          <div class="col-md-6">
            <div class="form-group mb-3">
              <label for="name" class="form-label">Nom du plan *</label>
              <input
                type="text"
                id="name"
                class="form-control"
                formControlName="name"
                placeholder="Ex: Plan Starter" />
              <div
                *ngIf="planForm.get('name')?.errors?.['required'] && planForm.get('name')?.touched"
                class="text-danger">
                Le nom du plan est requis
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-group mb-3">
              <label for="type" class="form-label">Type de plan *</label>
              <select id="type" class="form-control" formControlName="type">
                <option value="">Sélectionner un type</option>
                <option value="BASIC">Basique</option>
                <option value="PREMIUM">Premium</option>
                <option value="ENTERPRISE">Entreprise</option>
              </select>
              <div
                *ngIf="planForm.get('type')?.errors?.['required'] && planForm.get('type')?.touched"
                class="text-danger">
                Le type de plan est requis
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-md-6">
            <div class="form-group mb-3">
              <label for="price" class="form-label">Prix (€) *</label>
              <input
                type="number"
                id="price"
                class="form-control"
                formControlName="price"
                placeholder="0.00"
                min="0"
                step="0.01" />
              <div
                *ngIf="planForm.get('price')?.errors?.['required'] && planForm.get('price')?.touched"
                class="text-danger">
                Le prix est requis
              </div>
              <div
                *ngIf="planForm.get('price')?.errors?.['min'] && planForm.get('price')?.touched"
                class="text-danger">
                Le prix doit être positif
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="form-group mb-3">
              <label for="billingCycle" class="form-label">Cycle de facturation *</label>
              <select id="billingCycle" class="form-control" formControlName="billingCycle">
                <option value="">Sélectionner un cycle</option>
                <option value="MONTHLY">Mensuel</option>
                <option value="YEARLY">Annuel</option>
              </select>
              <div
                *ngIf="planForm.get('billingCycle')?.errors?.['required'] && planForm.get('billingCycle')?.touched"
                class="text-danger">
                Le cycle de facturation est requis
              </div>
            </div>
          </div>
        </div>

        <div class="form-group mb-3">
          <label for="description" class="form-label">Description</label>
          <textarea
            id="description"
            class="form-control"
            formControlName="description"
            rows="3"
            placeholder="Description du plan..."></textarea>
        </div>

        <div class="form-group mb-4">
          <label class="form-label">Fonctionnalités du plan</label>
          <div class="row">
            <div *ngFor="let feature of predefinedFeatures; let i = index" class="col-md-6 mb-2">
              <div class="form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  [id]="'feature-' + i"
                  [checked]="feature.included"
                  (change)="onFeatureChange(i, $event)" />
                <label class="form-check-label" [for]="'feature-' + i">
                  {{ feature.name }}
                </label>
              </div>
            </div>
          </div>
        </div>

        <div class="form-group mb-4">
          <label class="form-label">Fonctionnalités personnalisées</label>
          <div formArrayName="customFeatures">
            <div
              *ngFor="let featureControl of getCustomFeatures().controls; let i = index"
              class="row mb-2"
              [formGroupName]="i">
              <div class="col-md-10">
                <input
                  type="text"
                  class="form-control"
                  formControlName="name"
                  placeholder="Nom de la fonctionnalité" />
              </div>
              <div class="col-md-2">
                <button
                  type="button"
                  class="btn btn-danger btn-sm w-100"
                  (click)="removeCustomFeature(i)">
                  Supprimer
                </button>
              </div>
            </div>
          </div>
          <button type="button" class="btn btn-secondary btn-sm mt-2" (click)="addCustomFeature()">
            + Ajouter une fonctionnalité
          </button>
        </div>

        <div class="d-flex justify-content-between">
          <button type="button" class="btn btn-secondary" (click)="onCancel()">Annuler</button>
          <button type="submit" class="btn btn-primary" [disabled]="planForm.invalid || loading">
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
            {{ loading ? 'Création...' : 'Créer le plan' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
